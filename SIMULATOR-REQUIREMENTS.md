# Traffic Network Simulator Requirements

## Objective
Construct a simulator for the Tre Torri street network that can compare baseline travel times with scenario-based adjustments (e.g., direction changes, lane reductions) while leveraging the observed Google Routes dataset.

## Functional Requirements
- **Scenario Support**
- Represent network edits such as setting segments to one-way (forward or reverse), changing lane counts/capacity, or modifying turn permissions.
- Allow batch definition of scenarios so multiple proposals can be evaluated in a single run.
  - Directionality inputs must come from the authoritative segment configuration; temporary frontend overrides are brittle and should be removed once the simulator exposes current settings.
- **Input Data**
  - Consume the historical JSONL dataset generated by the poller, including live/static durations, derived flow metrics, and allowed direction metadata per segment and timestamp.
  - Accept future calibration datasets, including manual traffic counts (e.g., 2023 campaigns) to tune BPR parameters or validate results.
- **Baseline Modeling**
- Build a graph representation from `src/segments.js`, capturing endpoints, lengths, capacities, and directionality.
- Support evolving directionality over time; the simulator must handle historical periods where a segment was two-way versus the current configuration.
  - Provide an API/registry that the UI can query to avoid maintaining hard-coded overrides for one-way segments.
- **Flow/Delay Estimation**
  - Use BPR (or similar) performance functions with configurable α/β per segment or global defaults.
  - Provide hooks to recalibrate α/β using manual counts when available.
  - Allow alternate delay models (queueing, shockwave approximations) to be plugged in for sensitivity analysis.
- **Outputs**
  - Produce per-segment travel-time deltas, flow estimates, and v/c ratios for each scenario relative to the baseline.
  - Support export formats compatible with the frontend (e.g., JSON/GeoJSON snapshots) and documentation of assumptions/results.
- **Compatibility**
  - Expose an API or CLI interface so the frontend visualization agent can load scenario outputs.
  - Ensure results can be versioned and compared to actual observations for validation.

## Non-Functional Requirements
- **Performance**
  - Handle the current network size (dozens of segments) with the ability to scale to nearby expansions without major rewrites.
  - Provide execution summaries (timing, convergence metrics if iterative).
- **Maintainability**
  - Modular architecture to separate data ingestion, network modeling, scenario definition, and solver/assignment logic.
  - Configurable via declarative scenario files (JSON/YAML) to minimize code changes for new experiments.
- **Testing**
  - Include unit tests for network construction, scenario overlays, and delay calculations.
  - Support regression tests that compare simulated outputs against a subset of observed data.

## Open Questions / Future Work
- Determine which manual traffic counts (e.g., 2023 surveys) are available for calibration and validation.
- Decide whether the simulator needs stochastic components (variability bands) or deterministic averages are sufficient.
- Evaluate the need for OD matrices or whether per-link adjustments suffice for near-term experiments.
